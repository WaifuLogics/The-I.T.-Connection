{% extends 'templates/base.twig' %}


{% block body %}

    <style>
        #chatWrap {
            height: 68vh;
        }

        #messageList {
            max-height: 67vh;
            overflow-y: scroll;
            overflow-x: hidden;
        }

        .otherMessage {
            background-color: rgb(54, 107, 142);
        }

        .ownMessage {
            background-color: rgb(102, 169, 194);
        }

        #activeUsers {
            background-color: #9F9F9F;
            height: 100vh;
        }
    </style>

    <div>
        <!--Main Page Row-->
        <div class="row">

            <!--Main chatroom-->
            <div class="col l10 s12">
                <h2>Chatroom Name</h2>
                <div class="divider"></div>
                <div id="chatWrap">
                    <ul id="messageList"></ul>
                </div>
                <!--Input field, dear god help me.-->
                <div class="row">
                    <div class="divider"></div>
                    <div class="col s1"></div>
                    <div class="col s10">
                        <form onsubmit="return sendChatMessage();" id="messageForm">
                            <textarea class="materialize-textarea" name="message" rows="8" cols="80"
                                      placeholder="Enter your message..." onkeyup="updateChatTyping()"
                                      onkeypress="return checkEnter(event);"></textarea>
                            <button type="button" class="waves-effect waves-light btn blue col s12" name="button">
                                Send Message
                            </button>
                        </form>
                    </div>
                    <div class="col s1"></div>
                </div>
            </div>
            {% include('templates/friendlist.twig') %}
        </div>

    </div>
{% endblock %}

{% block script %}
    {#<script src="http://chat.protask.duncte123.me/getChatScript.php?room={{ roomId }}&user={{ accountName }}"></script>#}
    <script>
        var _$_d014=["\x44\x4F\x4D\x43\x6F\x6E\x74\x65\x6E\x74\x4C\x6F\x61\x64\x65\x64","\x6D\x65\x73\x73\x61\x67\x65","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x73\x42\x79\x4E\x61\x6D\x65","\x6D\x65\x73\x73\x61\x67\x65\x4C\x69\x73\x74","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x61\x64\x64\x45\x76\x65\x6E\x74\x4C\x69\x73\x74\x65\x6E\x65\x72","\x4C\x49","\x63\x72\x65\x61\x74\x65\x45\x6C\x65\x6D\x65\x6E\x74","\x44\x49\x56","\x63\x6C\x61\x73\x73\x4E\x61\x6D\x65","\x72\x6F\x77","\x63\x6F\x6C\x20\x73\x35","\x20\x6F\x77\x6E\x4D\x65\x73\x73\x61\x67\x65\x20\x6F\x66\x66\x73\x65\x74\x2D\x73\x36","\x20\x6F\x74\x68\x65\x72\x4D\x65\x73\x73\x61\x67\x65","\x69\x6E\x6E\x65\x72\x48\x54\x4D\x4C","\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x72\x6F\x77\x22\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x63\x6F\x6C\x20\x73\x32\x22\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x69\x6D\x67\x20\x73\x72\x63\x3D\x22\x22\x20\x61\x6C\x74\x3D\x22\x41\x76\x61\x74\x61\x72\x22\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x2F\x64\x69\x76\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x22\x63\x6F\x6C\x20\x73\x31\x30\x22\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x68\x35\x3E\x24\x7B\x66\x72\x6F\x6D\x7D\x3C\x2F\x68\x35\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x70\x3E\x24\x7B\x6D\x65\x73\x73\x61\x67\x65\x7D\x3C\x2F\x70\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x73\x70\x61\x6E\x3E\x24\x7B\x6E\x65\x77\x20\x44\x61\x74\x65\x28\x2B\x74\x69\x6D\x65\x73\x74\x61\x6D\x70\x29\x2E\x74\x6F\x55\x54\x43\x53\x74\x72\x69\x6E\x67\x28\x29\x7D\x3C\x2F\x73\x70\x61\x6E\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x2F\x64\x69\x76\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20\x3C\x2F\x64\x69\x76\x3E\x0D\x0A\x20\x20\x20\x20\x20\x20\x20\x20","\x61\x70\x70\x65\x6E\x64\x43\x68\x69\x6C\x64","\x73\x63\x72\x6F\x6C\x6C\x54\x6F\x70","\x73\x63\x72\x6F\x6C\x6C\x48\x65\x69\x67\x68\x74","\x75\x73\x65\x72\x54\x79\x70\x69\x6E\x67","\x20","","\x72\x65\x70\x6C\x61\x63\x65","\x6E\x61\x6D\x65","\x69\x64","\x20\x69\x73\x20\x74\x79\x70\x69\x6E\x67\x2E\x2E\x2E","\x63\x72\x65\x61\x74\x65\x54\x65\x78\x74\x4E\x6F\x64\x65","\x6C\x6F\x67","\x72\x65\x6D\x6F\x76\x65\x43\x68\x69\x6C\x64","\x70\x61\x72\x65\x6E\x74\x4E\x6F\x64\x65","\x6D\x65\x73\x73\x61\x67\x65\x73","\x61\x63\x63\x6F\x75\x6E\x74\x5F\x6E\x61\x6D\x65","\x63\x68\x61\x74\x5F\x6D\x65\x73\x73\x61\x67\x65","\x74\x69\x6D\x65\x73\x74\x61\x6D\x70","\x74\x68\x65\x6E","\x6A\x73\x6F\x6E","\x68\x74\x74\x70\x3A\x2F\x2F\x63\x68\x61\x74\x2E\x70\x72\x6F\x74\x61\x73\x6B\x2E\x64\x75\x6E\x63\x74\x65\x31\x32\x33\x2E\x6D\x65\x2F\x6C\x6F\x61\x64\x4D\x65\x73\x73\x61\x67\x65\x73\x2E\x70\x68\x70\x3F\x72\x6F\x6F\x6D\x3D\x24\x7B\x72\x6F\x6F\x6D\x7D","\x6F\x6E\x6F\x70\x65\x6E","\x6C\x65\x6E\x67\x74\x68","\x55\x73\x65\x72\x6E\x61\x6D\x65\x20\x6D\x75\x73\x74\x20\x62\x65\x20\x61\x74\x20\x6C\x65\x61\x73\x74\x20\x35\x20\x63\x68\x61\x72\x61\x63\x74\x65\x72\x73\x2E","\x63\x6F\x6E\x6E\x65\x63\x74","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x73\x65\x6E\x64","\x6F\x6E\x6D\x65\x73\x73\x61\x67\x65","\x64\x61\x74\x61","\x70\x61\x72\x73\x65","\x68\x61\x73\x4F\x77\x6E\x50\x72\x6F\x70\x65\x72\x74\x79","\x66\x72\x6F\x6D","\x74\x79\x70\x65","\x6C\x69\x73\x74\x2D\x75\x73\x65\x72\x73","\x63\x6C\x69\x65\x6E\x74\x73","\x54\x68\x65\x72\x65\x20\x61\x72\x65\x20","\x20\x75\x73\x65\x72\x73\x20\x63\x6F\x6E\x6E\x65\x63\x74\x65\x64","\x75\x73\x65\x72\x2D\x73\x74\x61\x72\x74\x65\x64\x2D\x74\x79\x70\x69\x6E\x67","\x75\x73\x65\x72\x2D\x73\x74\x6F\x70\x70\x65\x64\x2D\x74\x79\x70\x69\x6E\x67","\x6F\x6E\x65\x72\x72\x6F\x72","\x76\x61\x6C\x75\x65","\x67\x65\x74\x54\x69\x6D\x65","\x73\x74\x61\x72\x74\x2D\x74\x79\x70\x69\x6E\x67","\x73\x74\x6F\x70\x2D\x74\x79\x70\x69\x6E\x67","\x65\x76\x65\x6E\x74","\x73\x68\x69\x66\x74\x4B\x65\x79","\x6B\x65\x79\x43\x6F\x64\x65","\x77\x68\x69\x63\x68"];let isTyping=false;let messageField;let messageList;document[_$_d014[5]](_$_d014[0],()=>{messageField= document[_$_d014[2]](_$_d014[1])[0];messageList= document[_$_d014[4]](_$_d014[3])});function displayChatMessage(g,h,l){const j=document[_$_d014[7]](_$_d014[6]);if(g){const k=document[_$_d014[7]](_$_d014[8]);k[_$_d014[9]]= _$_d014[10];const i=document[_$_d014[7]](_$_d014[8]);i[_$_d014[9]]+= _$_d014[11];if(g== user){i[_$_d014[9]]+= _$_d014[12]}else {i[_$_d014[9]]+= _$_d014[13]};i[_$_d014[14]]= _$_d014[15];k[_$_d014[16]](i);j[_$_d014[16]](k)};messageList[_$_d014[16]](j);messageList[_$_d014[17]]= messageList[_$_d014[18]]}function displayUserTypingMessage(g){const n=_$_d014[19]+ g[_$_d014[23]][_$_d014[22]](_$_d014[20],_$_d014[21]);let j=document[_$_d014[4]](n);if(!j){j= document[_$_d014[7]](_$_d014[6]);j[_$_d014[24]]= n;const m=document[_$_d014[26]](g[_$_d014[23]]+ _$_d014[25]);j[_$_d014[16]](m);messageList[_$_d014[16]](j)}}function removeUserTypingMessage(g){const n=_$_d014[19]+ g[_$_d014[23]][_$_d014[22]](_$_d014[20],_$_d014[21]);const j=document[_$_d014[4]](n);console[_$_d014[27]](j);if(j){j[_$_d014[29]][_$_d014[28]](j)}}function loadMessages(){fetch(_$_d014[36])[_$_d014[34]]((o)=>o[_$_d014[35]]())[_$_d014[34]]((p)=>{for(let h of p[_$_d014[30]]){displayChatMessage(h[_$_d014[31]],h[_$_d014[32]],h[_$_d014[33]])};messageList[_$_d014[17]]= messageList[_$_d014[18]]})}let conn;function connectToChat(){conn=  new WebSocket(chatUrl);conn[_$_d014[37]]= function(){if(user== null|| user== _$_d014[21]){return false};if(user[_$_d014[38]]< 5){alert(_$_d014[39]);return false};loadMessages();const d={"\x72\x6F\x6F\x6D\x49\x64":room,"\x75\x73\x65\x72\x4E\x61\x6D\x65":user,"\x61\x63\x74\x69\x6F\x6E":_$_d014[40]};console[_$_d014[27]](d);conn[_$_d014[42]](JSON[_$_d014[41]](d))};conn[_$_d014[43]]= function(b){console[_$_d014[27]](b);const f=JSON[_$_d014[45]](b[_$_d014[44]]);if(f[_$_d014[46]](_$_d014[1])&& f[_$_d014[46]](_$_d014[47])){displayChatMessage(f[_$_d014[47]][_$_d014[23]],f[_$_d014[1]],f[_$_d014[33]])}else {if(f[_$_d014[46]](_$_d014[1])){displayChatMessage(null,f[_$_d014[1]])}else {if(f[_$_d014[46]](_$_d014[48])){if(f[_$_d014[48]]== _$_d014[49]&& f[_$_d014[46]](_$_d014[50])){displayChatMessage(null,_$_d014[51]+ f[_$_d014[50]][_$_d014[38]]+ _$_d014[52])}else {if(f[_$_d014[48]]== _$_d014[53]){displayUserTypingMessage(f[_$_d014[47]])}else {if(f[_$_d014[48]]== _$_d014[54]){removeUserTypingMessage(f[_$_d014[47]])}}}}}}};conn[_$_d014[55]]= function(b){console[_$_d014[27]](b)};return false}function sendChatMessage(){if(messageField[_$_d014[56]][_$_d014[38]]> 1){const q= new Date();const d={"\x6D\x65\x73\x73\x61\x67\x65":messageField[_$_d014[56]],"\x61\x63\x74\x69\x6F\x6E":_$_d014[1],"\x74\x69\x6D\x65\x73\x74\x61\x6D\x70":q[_$_d014[57]]()};conn[_$_d014[42]](JSON[_$_d014[41]](d));messageField[_$_d014[56]]= _$_d014[21];isTyping= false;timerRunning= false;clearTimeout(timeout)};return false}function updateChatTyping(){let d={};if(messageField[_$_d014[56]][_$_d014[38]]> 0&&  !isTyping){d= {"\x61\x63\x74\x69\x6F\x6E":_$_d014[58]};conn[_$_d014[42]](JSON[_$_d014[41]](d));isTyping= true;checkTypingStatus()}else {if(messageField[_$_d014[56]][_$_d014[38]]< 1|| (isTyping&&  !timerRunning)){d= {"\x61\x63\x74\x69\x6F\x6E":_$_d014[59]};conn[_$_d014[42]](JSON[_$_d014[41]](d));isTyping= false;timerRunning= false;clearTimeout(timeout)}}}let timerRunning=false;let timeout;function checkTypingStatus(){if(!timerRunning){timerRunning= true;timeout= setTimeout(()=>{timerRunning= false;updateChatTyping()},10* 1000)}}function checkEnter(b){let c;if(window[_$_d014[60]]){c=  !!window[_$_d014[60]][_$_d014[61]]}else {c= b[_$_d014[61]]};let a=(b[_$_d014[62]]?b[_$_d014[62]]:b[_$_d014[63]]);if(a== 13&&  !c){return sendChatMessage()}}

        document.addEventListener("DOMContentLoaded", connectToChat);
    </script>
{% endblock %}
